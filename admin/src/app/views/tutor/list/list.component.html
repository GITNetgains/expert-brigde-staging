<div class="row">
  <div class="col-12">
    <c-card class="mb-4 filter-card">
      <c-card-header>
        <div>
          <h4 class="mb-0">Manage Experts</h4>
          <p class="text-body-secondary small mb-0 mt-1">Search and filter the experts list</p>
        </div>
      </c-card-header>
      <c-card-body>
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <label class="form-label">Name</label>
            <input
              type="text"
              name="name"
              cFormControl
              class="form-control"
              [(ngModel)]="searchFields.name"
              placeholder="Search by name"
            />
          </div>
          <div class="col-md-3">
            <label class="form-label">Email</label>
            <input
              type="text"
              name="email"
              cFormControl
              class="form-control"
              [(ngModel)]="searchFields.email"
              placeholder="Search by email"
            />
          </div>
          <div class="col-md-2">
            <label class="form-label">Status</label>
            <select cSelect [(ngModel)]="searchFields.status" class="form-select">
              <option value="">All statuses</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
              <option value="pending">Pending</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Rating</label>
            <select cSelect [(ngModel)]="searchFields.rating" class="form-select">
              <option value="">Any rating</option>
              <option value="5">5 stars</option>
              <option value="4">4 stars</option>
              <option value="3">3 stars</option>
              <option value="2">2 stars</option>
              <option value="1">1 star</option>
              <option value="0">No rating</option>
            </select>
          </div>
          <div class="col-md-2 d-flex gap-2">
            <button cButton color="primary" class="flex-grow-1" (click)="filter()">
              Filter
            </button>
            <button cButton color="secondary" (click)="clearFilters()" title="Clear filters">
              Clear
            </button>
          </div>
        </div>
      </c-card-body>
    </c-card>

    <c-card>
      <c-card-header>
        <div
          class="d-flex flex-wrap justify-content-between align-items-center gap-2"
        >
          <h4 class="mb-0">
            <span class="text-body-secondary fw-normal">Total experts:</span>
            <span class="badge bg-primary ms-2">{{ count }}</span>
          </h4>
          @if(count !== 0){
          <app-pagination
            [currentPage]="currentPage"
            [pageSize]="pageSize"
            [totalItems]="count"
            [maxSize]="3"
            (pageChanged)="onPageChange($event)"
          ></app-pagination>
          }
        </div>
      </c-card-header>
      @if(count !== 0){
      <c-card-body>
        <div class="table-responsive">
          <table
            cTable
            class="tutor-table"
            [responsive]="true"
            [cBorder]="1"
            borderColor="gray"
            bordered
            style="table-layout: fixed; width: 1610px"
          >
            <thead>
              <tr>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="name"
                    [sortOption]="sortOption"
                    sortTitle="Name"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="username"
                    [sortOption]="sortOption"
                    sortTitle="User Name"
                  ></app-sort>
                </th>
                <th style="width: 250px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="email"
                    [sortOption]="sortOption"
                    sortTitle="Email"
                  ></app-sort>
                </th>
                <th style="width: 150px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="ratingAvg"
                    [sortOption]="sortOption"
                    sortTitle="Rating"
                  ></app-sort>
                </th>
                <th style="width: 150px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="isActive"
                    [sortOption]="sortOption"
                    sortTitle="Active"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="emailVerified"
                    [sortOption]="sortOption"
                    sortTitle="Email Verified"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="isZoomAccount"
                    [sortOption]="sortOption"
                    sortTitle="Zoom Activation"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="isHomePage"
                    [sortOption]="sortOption"
                    sortTitle="In Home Page"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="featured"
                    [sortOption]="sortOption"
                    sortTitle="Featured"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="rejected"
                    [sortOption]="sortOption"
                    sortTitle="Approved"
                  ></app-sort>
                </th>
                <th style="width: 200px">
                  <app-sort
                    (onSort)="onSort($event)"
                    sortBy="createdAt"
                    [sortOption]="sortOption"
                    sortTitle="Created On"
                  ></app-sort>
                </th>
                <th
                  class="action-cell"
                  style="
                    width: 120px;
                    min-width: 120px;
                    position: sticky;
                    right: 0;
                    z-index: 10;
                    box-shadow: inset -1px 0 0 var(--cui-border-color),
                      inset 1px 0 0 var(--cui-border-color);
                    background: var(--cui-body-bg);
                  "
                >
                  Action
                </th>
              </tr>
            </thead>

            <tbody>
              @for(item of items; track item._id; let i = $index){
              <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.username }}</td>
                <td>{{ item.email }}</td>
                <td>{{ item.ratingAvg }}</td>
                <td>
                  @if(!item.isActive){<span
                    class="badge text-bg-warning text-white"
                    (click)="update(item, 'isActive', true)"
                    title="Click to activate"
                    >Inactive</span
                  >}@else{
                  <span
                    class="badge text-bg-success text-white"
                    (click)="update(item, 'isActive', false)"
                    title="Click to deactivate"
                    >Active</span
                  >}
                </td>
                <td>
                  @if(!item.emailVerified){
                  <span
                    class="badge text-bg-warning text-white"
                    (click)="update(item, 'emailVerified', true)"
                    title="Click to mark verified"
                    >Unverified</span
                  >}@else{
                  <span
                    class="badge text-bg-success text-white"
                    (click)="update(item, 'emailVerified', false)"
                    title="Click to unverify"
                    >Verified</span
                  >}
                </td>
                <td>
                  @if(item.isZoomAccount){
                  <span
                    class="badge text-bg-success text-white"
                    (click)="update(item, 'isZoomAccount', false)"
                    title="Click to deactivate Zoom"
                    >Connected</span
                  >}@else{
                  <span
                    class="badge text-bg-warning text-white"
                    (click)="update(item, 'isZoomAccount', true)"
                    title="Click to connect Zoom"
                    >Not connected</span
                  >}
                </td>
                <td>
                  @if(!item.isHomePage){<span
                    class="badge text-bg-warning text-white"
                    (click)="update(item, 'isHomePage', true)"
                    title="Click to show on homepage"
                    >Hidden</span
                  >} @else{<span
                    class="badge text-bg-success text-white"
                    (click)="update(item, 'isHomePage', false)"
                    title="Click to hide from homepage"
                    >Shown</span
                  >}
                </td>
                <td>
                  @if(!item.featured){
                  <span
                    class="badge text-bg-warning text-white"
                    (click)="update(item, 'featured', true)"
                    title="Click to feature"
                    >No</span
                  >} @else{<span
                    class="badge text-bg-success text-white"
                    (click)="update(item, 'featured', false)"
                    title="Click to unfeature"
                    >Featured</span
                  >}
                </td>
                <td>
                  @if(item.pendingApprove) {
                  <span class="badge text-bg-primary text-white">Pending</span>
                  } @else if(!item.pendingApprove && item.rejected){
                  <span
                    class="badge text-bg-danger text-white"
                    (click)="update(item, 'approved', true)"
                    title="Click to approve"
                    >Rejected</span
                  >
                  } @else{
                  <span
                    class="badge text-bg-success text-white"
                    (click)="update(item, 'approved', false)"
                    title="Click to reject"
                    >Approved</span
                  >
                  }
                </td>
                <td>
                  <span>{{ item.createdAt | date }}</span>
                </td>
                <td
                  class="action-cell"
                  style="
                    position: sticky;
                    right: 0;
                    z-index: 10;
                    box-shadow: inset -1px 0 0 var(--cui-border-color),
                      inset 1px 0 0 var(--cui-border-color);
                    background: var(--cui-body-bg);
                    overflow: hidden;
                    width: 120px;
                    min-width: 120px;
                    max-width: 120px;
                  "
                >
                  <div class="d-flex gap-1 flex-nowrap action-buttons">
                    <a
                      [routerLink]="['/tutor/update', item._id]"
                      cButton
                      class="btn btn-sm btn-primary"
                      title="Edit expert"
                    >
                      <svg cIcon name="cilPencil" size="sm"></svg>
                    </a>
                    <button
                      type="button"
                      cButton
                      [color]="item.isActive ? 'success' : 'danger'"
                      size="sm"
                      class="btn btn-sm"
                      (click)="changeStatus(item)"
                      [title]="item.isActive ? 'Deactivate' : 'Activate'"
                    >
                      @if(item.isActive){
                      <svg cIcon name="cilCheckCircle" class="text-white" size="sm"></svg>
                      } @else {
                      <svg cIcon name="cilXCircle" class="text-white" size="sm"></svg>
                      }
                    </button>
                    <button
                      type="button"
                      cButton
                      class="btn btn-sm btn-danger"
                      (click)="remove(item, i)"
                      title="Delete expert"
                    >
                      <svg cIcon name="cilTrash" size="sm"></svg>
                    </button>
                  </div>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </c-card-body>
      }@else {
      <c-card-body>
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ‘¤</div>
          <h5 class="text-body-secondary mb-2">No experts found</h5>
          <p class="text-body-secondary small mb-0">Try adjusting your filters or check back later.</p>
        </div>
      </c-card-body>
      }

      <c-card-footer class="d-flex justify-content-end">
        @if(count !== 0){
        <app-pagination
          [currentPage]="currentPage"
          [pageSize]="pageSize"
          [totalItems]="count"
          [maxSize]="3"
          (pageChanged)="onPageChange($event)"
        ></app-pagination>
        }
      </c-card-footer>
    </c-card>
  </div>
</div>
