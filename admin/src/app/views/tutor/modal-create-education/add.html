<c-modal
  [visible]="visible"
  (visibleChange)="handleModalChange($event)"
  alignment="center"
>
  <c-modal-header>
    <h5 cModalTitle>Certificate</h5>
    <button cButtonClose (click)="closeModal()"></button>
  </c-modal-header>
  <c-modal-body>
    <form #frm="ngForm" (submit)="submit(frm)">
      <div class="mb-3">
        <label cLabel>Title <span class="text-danger">*</span></label>
        <input
          cFormControl
          type="text"
          name="title"
          placeholder="Enter title"
          [ngModel]="certificate?.title"
          (ngModelChange)="updateTitle($event)"
          required
          #title="ngModel"
        />
        @if(title.errors && (title.dirty || title.touched || submitted)) {
        @if(title.errors['required']) {
        <div class="invalid-feedback d-block">Title is required!</div>
        } }
      </div>

      <div class="mb-3">
        <label cLabel>Description</label>
        <textarea
          cFormControl
          name="description"
          rows="3"
          placeholder="Enter some text here"
          [ngModel]="certificate?.description"
          (ngModelChange)="updateDescription($event)"
          #description="ngModel"
        ></textarea>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label cLabel>From year <span class="text-danger">*</span></label>
          <input
            cFormControl
            type="number"
            name="from-year"
            placeholder="From year"
            [ngModel]="certificate?.fromYear"
            (ngModelChange)="updateFromYear($event)"
            required
            #fromYear="ngModel"
            min="1900"
          />
          @if(fromYear.errors && (fromYear.dirty || fromYear.touched ||
          submitted)) { @if(fromYear.errors['required']) {
          <div class="invalid-feedback d-block">From year is required!</div>
          } }
        </div>

        <div class="col-md-6 mb-3">
          <label cLabel>To year <span class="text-danger">*</span></label>
          <input
            cFormControl
            type="number"
            name="to-year"
            placeholder="To year"
            [ngModel]="certificate?.toYear"
            (ngModelChange)="updateToYear($event)"
            required
            #toYear="ngModel"
            min="1900"
          />
          @if(toYear.errors && (toYear.dirty || toYear.touched || submitted)) {
          @if(toYear.errors['required']) {
          <div class="invalid-feedback d-block">To year is required!</div>
          } } @if(certificate?.toYear && certificate?.fromYear &&
          (certificate?.toYear < certificate?.fromYear) && submitted) {
          <div class="invalid-feedback d-block">
            To year must be greater than from year
          </div>
          }
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label cLabel>Ordering</label>
          <input
            cFormControl
            type="number"
            name="ordering"
            placeholder="Ordering"
            [ngModel]="certificate?.ordering"
            (ngModelChange)="updateOrdering($event)"
            #ordering="ngModel"
            [pattern]="'^[0-9][0-9]*$'"
          />
          @if(ordering.errors && (ordering.dirty || ordering.touched ||
          submitted)) { @if(ordering.errors['pattern']) {
          <div class="invalid-feedback d-block">
            This minimum ordering is <b>0</b>!
          </div>
          } }
        </div>

        <div class="col-md-6 mb-3">
          <label cLabel
            >Document <span class="text-danger">*</span>
            <small class="ms-1">(Maximum size: {{maxFileSize}} mb)</small>
          </label>
          <br />
          <span style="word-wrap: break-word;">{{certificate?.document?.name}}</span>
          <app-file-uploader [options]="uploaderOptions"></app-file-uploader>
        </div>
      </div>

      <div class="mb-3">
        <label cFormCheckLabel class="d-block mb-2">Verified</label>
        <c-form-check class="mb-2">
          <input
            cFormCheckInput
            type="checkbox"
            name="verified"
            [ngModel]="certificate?.verified"
            (ngModelChange)="updateVerified($event)"
          />
        </c-form-check>
        <small class="text-muted ms-2">Check the box to verify the document</small>
      </div>

      <div class="mt-3">
        <button cButton color="primary" type="submit" class="me-2">
          Submit
        </button>
        <button cButton color="secondary" type="button" (click)="closeModal()">
          Close
        </button>
      </div>
    </form>
  </c-modal-body>
</c-modal>
