<c-row>
  <c-col md="12">
    <!-- FILTER CARD -->
    <c-card class="mb-4">
      <c-card-header>
        <h4>Manage Clients</h4>
      </c-card-header>

      <c-card-body>
        <c-row>
          <c-col md="3">
            <div class="mb-3">
              <input
                cFormControl
                type="text"
                placeholder="Enter name"
                [(ngModel)]="searchFields.name"
              />
            </div>
          </c-col>

          <c-col md="3">
            <div class="mb-3">
              <input
                cFormControl
                type="text"
                placeholder="Enter email"
                [(ngModel)]="searchFields.email"
              />
            </div>
          </c-col>

          <c-col md="2">
            <div class="mb-3">
              <select cSelect [(ngModel)]="searchFields.isActive">
                <option value="">Active?</option>
                <option value="1">Yes</option>
                <option value="0">No</option>
              </select>
            </div>
          </c-col>

          <c-col md="2">
            <div class="mb-3">
              <select cSelect [(ngModel)]="searchFields.emailVerified">
                <option value="">Email verified?</option>
                <option value="1">Yes</option>
                <option value="0">No</option>
              </select>
            </div>
          </c-col>

          <c-col md="2">
            <div class="mb-3">
              <button
                cButton
                color="primary"
                class="w-100"
                (click)="filter()"
              >
                Filter
              </button>
            </div>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>

    <!-- TABLE CARD -->
    <c-card>
      <c-card-header>
        <div class="d-flex justify-content-between align-items-center flex-wrap">
          <h4 class="mb-0">Total Clients: {{ count }}</h4>

          <app-pagination
            *ngIf="count > 0"
            [currentPage]="currentPage"
            [pageSize]="pageSize"
            [totalItems]="count"
            [maxSize]="3"
            (pageChanged)="onPageChange($event)"
          ></app-pagination>
        </div>
      </c-card-header>

      <!-- TABLE -->
      <c-card-body *ngIf="count > 0; else noData">
        <div class="table-responsive">
          <table
            cTable
            bordered
            [responsive]="true"
            [cBorder]="1"
            borderColor="gray"
            style="table-layout: fixed; width: 1610px"
          >
            <thead>
              <tr>
                <th style="width:150px">
                  <app-sort
                    sortBy="name"
                    sortTitle="Name"
                    [sortOption]="sortOption"
                    (onSort)="onSort($event)"
                  ></app-sort>
                </th>

                <th style="width:150px">
                  <app-sort
                    sortBy="email"
                    sortTitle="Email"
                    [sortOption]="sortOption"
                    (onSort)="onSort($event)"
                  ></app-sort>
                </th>

                <th style="width:100px">Active</th>
                <th style="width:100px">Email verified</th>
                <th style="width:120px">Created On</th>
                <th style="width:300px">Description</th>

                <th
                  style="
                    width:50px;
                    position: sticky;
                    right: 0;
                    z-index: 10;
                    background: white;
                  "
                >
                  Action
                </th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let item of items; trackBy: trackById">
                <td>{{ item.name }}</td>
                <td>{{ item.email }}</td>

                <td>
                  <span
                    class="badge cursor-pointer"
                    [ngClass]="item.isActive ? 'bg-success' : 'bg-warning'"
                    (click)="update(item, 'isActive', !item.isActive)"
                  >
                    {{ item.isActive ? 'Y' : 'N' }}
                  </span>
                </td>

                <td>
                  <span
                    class="badge cursor-pointer"
                    [ngClass]="item.emailVerified ? 'bg-success' : 'bg-warning'"
                    (click)="update(item, 'emailVerified', !item.emailVerified)"
                  >
                    {{ item.emailVerified ? 'Y' : 'N' }}
                  </span>
                </td>

                <td>{{ item.createdAt | date }}</td>

                <td>
                  <span [title]="item.bio">
                    {{ item.bio ? (item.bio | slice:0:120) : '-' }}
                    {{ item.bio?.length > 120 ? '...' : '' }}
                  </span>
                </td>

                <td
                  style="
                    position: sticky;
                    right: 0;
                    z-index: 10;
                    background: white;
                  "
                >
                  <a
                    cButton
                    class="btn btn-sm btn-primary me-1"
                    [routerLink]="['/users/update', item._id]"
                  >
                    <svg cIcon name="cilPencil" size="sm"></svg>
                  </a>

                  <button
                    cButton
                    class="btn btn-sm btn-danger"
                    (click)="remove(item)"
                  >
                    <svg cIcon name="cilTrash" size="sm"></svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </c-card-body>

      <!-- NO DATA -->
      <ng-template #noData>
        <c-card-body>
          <div class="p-3 bg-warning rounded">
            There are no items
          </div>
        </c-card-body>
      </ng-template>

      <c-card-footer class="d-flex justify-content-end" *ngIf="count > 0">
        <app-pagination
          [currentPage]="currentPage"
          [pageSize]="pageSize"
          [totalItems]="count"
          [maxSize]="3"
          (pageChanged)="onPageChange($event)"
        ></app-pagination>
      </c-card-footer>
    </c-card>
  </c-col>
</c-row>
