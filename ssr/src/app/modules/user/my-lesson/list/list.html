<div class="dashboard-wrapper sm-padding">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12 mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
          <h2 class="dashboard-title" translate>My Appointments</h2>
          
          <ul class="nav nav-pills custom-pills" role="tablist">
            <li class="nav-item" [ngClass]="{'active-pill': tab === 'subject'}">
              <a href="javascript:void(0)" (click)="onTabSelect('subject')" class="nav-link" translate>
                <i class="fi fi-rr-user-step me-2"></i>One on One sessions
              </a>
            </li>
            <li class="nav-item" [ngClass]="{'active-pill': tab === 'webinar'}">
              <a href="javascript:void(0)" (click)="onTabSelect('webinar')" class="nav-link" translate>
                <i class="fi fi-rr-users me-2"></i>Group Sessions
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="col-md-12 animate-fade-in" *ngIf="tab === 'subject'">
        <div class="glass-card mb-4">
          <div class="card-body p-3">
            <div class="row align-items-center">
              <div class="col-md-3 mb-2 mb-md-0">
                <div class="input-group-modern ">
                  <select class="form-select border-0 shadow-none bg-transparent" [(ngModel)]="filterBy" (change)="filterByDate()">
                    <option value="all_day" selected>All days</option>
                    <option value="today">Today</option>
                    <option value="this_week">This week</option>
                  </select>
                </div>
              </div>
              <div class="col-md-5">
                <div class="search-wrapper">
                  <i class="fi fi-rr-search me-2 text-muted"></i>
                  <input type="search" class="form-control border-0 shadow-none bg-transparent" placeholder="{{'Search Expert, user, session'}}" (keyup)="doSearch($event)" />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="main-card card border-0 shadow-sm">
          <div class="table-responsive">
            <table class="table custom-table align-middle">
              <thead>
                <tr>
                  <th>
                    <div class="th-content" (click)="sortBy('tutorInfo.name', 'desc')">
                      <span translate>Expert Name</span>
                      <app-sort [sortOption]="sortOption" [sortBy]="'tutorInfo.name'" (doSort)="onSort($event)"></app-sort>
                    </div>
                  </th>
                  <th>
                    <div class="th-content" (click)="sortBy('webinarId', 'desc')">
                      <span translate>Session Type</span>
                      <app-sort [sortOption]="sortOption" [sortBy]="'webinarId'" (doSort)="onSort($event)"></app-sort>
                    </div>
                  </th>
                  <th>
                    <div class="th-content" (click)="sortBy('paid', 'desc')">
                      <span translate>Paid</span>
                      <app-sort [sortOption]="sortOption" [sortBy]="'paid'" (doSort)="onSort($event)"></app-sort>
                    </div>
                  </th>
                  <th><span translate>Time Window</span></th>
                  <th><span translate>Status</span></th>
                  <th class="text-end"><span translate>Action</span></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="loading"><td colspan="9" class="text-center py-5"><div class="spinner-border text-primary"></div></td></tr>
                <tr *ngIf="!appointments.length && !loading">
                  <td colspan="9" class="text-center py-5 text-muted"><span translate>There are no lessons available</span></td>
                </tr>
                
                <tr *ngFor="let item of appointments; let i = index" class="table-row-hover">
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="avatar-circle me-2"><i class="fi fi-rr-user"></i></div>
                      <a class="hyperlink fw-bold" target="_blank" [routerLink]="['/experts', item?.tutor?.username]">{{ item?.tutor?.showPublicIdOnly === true ? item?.tutor?.userId : item?.tutor?.name }}</a>
                    </div>
                  </td>
                  <td>{{(item?.webinar?.name || item?.subject?.name || '') | ellipsis:50}}</td>
                  <td>
                    <span class="badge" [ngClass]="item?.paid ? 'badge-soft-success' : 'badge-soft-danger'">
                      {{ item?.paid ? 'Paid' : 'Unpaid' }}
                    </span>
                  </td>
                  <td>
                    <div class="time-slot-container">
                      <div class="small text-muted">{{item?.startTime | date:'dd MMM, HH:mm'}}</div>
                      <div class="small text-muted">{{item?.toTime | date:'dd MMM, HH:mm'}}</div>
                    </div>
                  </td>
                  <td><app-appointment-status [status]="item?.status || ''"></app-appointment-status></td>
                  <td class="text-end">
                    <div class="action-flex-container">
                      <a [routerLink]="['/users/lessons', item._id ]" class="btn-action-custom btn-view-orange me-2">
                        <i class="fi fi-rr-eye"></i>
                      </a>
                      <a *ngIf="item?.status==='pending' || item?.status === 'progressing'" 
                         href="javascript:void(0)" 
                         class="zoom-action-link" 
                         (click)="joinMeeting(item._id)">
                        <img src="assets/images/zoom.png" alt="Join Zoom" class="zoom-icon-small"/>
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="card-footer bg-white border-0 py-3 d-flex justify-content-between">
            <span class="text-muted small">Showing {{appointments.length}} of {{total}}</span>
            <ngb-pagination [collectionSize]="total" [(page)]="currentPage" [pageSize]="pageSize" [maxSize]="2" (pageChange)="pageChange()">
                <ng-template ngbPaginationPrevious><i class="fi fi-rr-angle-small-left"></i></ng-template>
                <ng-template ngbPaginationNext><i class="fi fi-rr-angle-small-right"></i></ng-template>
            </ngb-pagination>
          </div>
        </div>
      </div>

      <div class="col-md-12 animate-fade-in" *ngIf="tab === 'webinar'">
        <div class="glass-card mb-4">
          <div class="card-body p-3 row align-items-center">
            <div class="col-md-3"><select class="form-select border-0 bg-transparent" [(ngModel)]="filterBy" (change)="filterByDate()"><option value="all_day">All day</option><option value="today">Today</option></select></div>
            <div class="col-md-5"><div class="search-wrapper"><i class="fi fi-rr-search me-2"></i><input type="search" class="form-control border-0 bg-transparent" placeholder="{{'Search expert, user, webinar'}}" (keyup)="doSearch($event)" /></div></div>
          </div>
        </div>

        <div class="main-card card border-0 shadow-sm">
          <div class="table-responsive">
            <table class="table custom-table align-middle">
              <thead>
                <tr>
                  <th><span translate>Expert Name</span></th>
                  <th><span translate>Group Session</span></th>
                  <th class="text-end"><span translate>Action</span></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="loading"><td colspan="3" class="text-center py-5"><div class="spinner-border text-primary"></div></td></tr>
                <tr *ngFor="let item of transactions" class="table-row-hover">
                  <td>
                    <div class="d-flex align-items-center">
                        <div class="avatar-circle me-2"><i class="fi fi-rr-user"></i></div>
                        <a class="hyperlink fw-bold" target="_blank" [routerLink]="['/experts', item?.tutor?.username]">{{ item?.tutor?.showPublicIdOnly === true ? item?.tutor?.userId : item?.tutor?.name }}</a>
                    </div>
                  </td>
                  <td>{{item.webinar ? item?.webinar?.name : '-'}}</td>
                  <td class="text-end">
                    <button class="btn btn-light-primary btn-sm rounded-pill px-3" (click)="openModalAppointment(item)">
                      View list appointments
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Scoped Styles for Modern UI */
.dashboard-wrapper { background: #f8f9fa; min-height: 100vh; font-family: 'Inter', sans-serif; }
.dashboard-title { font-weight: 800; color: #2d3436; }

/* Pills */
.custom-pills { background: #e9ecef; padding: 5px; border-radius: 14px; display: inline-flex; }
.custom-pills .nav-link { border-radius: 10px; color: #636e72; border: none; font-weight: 500; }
.active-pill .nav-link { background: #ee5253 !important; color: #f6f6f8 !important; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

/* Cards & Tables */
.glass-card { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 16px; border: 1px solid #fff; }
.main-card { border-radius: 16px; overflow: hidden; }
.custom-table thead { background: #f1f3f5; }
.custom-table th { border: none; font-size: 11px; text-transform: uppercase; color: #adb5bd; padding: 15px; }
.table-row-hover:hover { background: #f8f9ff; transition: 0.3s; }

/* Components */
.search-wrapper { display: flex; align-items: center; background: #fff; padding: 0 12px; border-radius: 10px; border: 1px solid #dee2e6; }
.avatar-circle { width: 32px; height: 32px; background: #e9ecef; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #adb5bd; }
.badge-soft-success { background: #d1f7e0; color: #10ac84; }
.badge-soft-danger { background: #ffdada; color: #ee5253; }
.animate-fade-in { animation: fadeIn 0.4s ease; }
.action-flex-container {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
}

/* Eye Icon Button */
.btn-action-custom {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  background-color: #e65f41; /* Matching your screenshot orange */
  color: white !important;
  text-decoration: none;
  transition: opacity 0.2s;
}

.btn-action-custom:hover {
  opacity: 0.9;
}

/* Zoom Icon Constraints */
.zoom-action-link {
  display: inline-flex;
  width: 32px;
  height: 32px;
  align-items: center;
  justify-content: center;
  flex-shrink: 0; /* Prevents stretching */
}

.zoom-icon-small {
  width: 32px;  /* Fixed size */
  height: 32px; /* Fixed size */
  object-fit: contain;
  transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.zoom-action-link:hover .zoom-icon-small {
  transform: scale(1.15);
}

/* Time Slot Spacing */
.time-slot-container {
  line-height: 1.2;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>