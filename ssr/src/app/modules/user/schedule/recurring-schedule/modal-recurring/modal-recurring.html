<div class="modal-header border-0 pb-0">
  <h4 class="modal-title fw-bold text-dark">Recurring Schedules</h4>
  <button type="button" class="btn-close shadow-none" aria-label="Close" (click)="close(null)"></button>
</div>

<div class="px-4 mt-3">
  <ul class="nav nav-pills nav-fill bg-light rounded-3 p-1" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link py-2 border-0" [class.active]="tab === 'list'" (click)="changeTab('list')" translate>
        <i class="fi fi-rr-list me-2"></i>View List
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link py-2 border-0" [class.active]="tab === 'add'" (click)="changeTab('add')" translate>
        <i class="fi fi-rr-plus me-2"></i>Create New
      </button>
    </li>
  </ul>
</div>

<div class="modal-body p-4">
  <div *ngIf="tab === 'list'" class="animate-fade-in">
    <app-recurring-list [isFree]="isFree"></app-recurring-list>
  </div>

  <form #frm="ngForm" (submit)="submit(frm)" class="recurring-form" *ngIf="tab === 'add'">
    
    <div class="alert alert-info border-0 shadow-sm mb-4 d-flex align-items-start">
      <i class="fi fi-rr-info me-3 mt-1 fs-5"></i>
      <div class="small text-secondary">
        <strong class="text-info d-block mb-1">Quick Guide:</strong>
        <span translate>Set your 24h time slots (min {{ slotDuration }}m), select days, and pick a date range. Note: Past slots cannot be booked.</span>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-12">
        <div class="card border-0 bg-light-subtle shadow-sm p-3 p-md-4">
          <label class="form-label fw-semibold text-muted small text-uppercase mb-3 d-block text-center text-md-start">
            Time Range Selection
          </label>
          
          <div class="d-flex flex-column flex-md-row align-items-center justify-content-around gap-3">
            
            <div class="time-picker-wrapper text-center">
              <label class="small text-muted mb-2 d-block">Start Time</label>
              <ngb-timepicker [(ngModel)]="timeStart" name="timeStart" [minuteStep]="5" [meridian]="false"></ngb-timepicker>
            </div>
      
            <div class="d-none d-md-block fs-4 text-primary opacity-50 mx-2">
              <i class="fi fi-rr-arrow-right"></i>
            </div>
            
            <div class="d-md-none border-top w-50 my-2"></div>
      
            <div class="time-picker-wrapper text-center">
              <label class="small text-muted mb-2 d-block">End Time</label>
              <ngb-timepicker [(ngModel)]="timeEnd" name="timeEnd" [minuteStep]="5" [meridian]="false"></ngb-timepicker>
            </div>
            
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-semibold text-muted small text-uppercase">Start Date</label>
        <div class="input-group modern-input-group">
          <span class="input-group-text bg-white"><i class="fi fi-rr-calendar text-primary"></i></span>
          <input readonly class="form-control border-start-0" placeholder="dd-mm-yyyy" name="startRecur"
            [(ngModel)]="range.start" ngbDatepicker #b="ngbDatepicker" #startRecur="ngModel" required
            (ngModelChange)="selectDate($event, 'start')" [minDate]="minDate" (click)="b.toggle()" />
        </div>
        <div *ngIf="validTime['start']" class="text-danger small mt-1">{{ dateErrorMessages['start'] }}</div>
      </div>

      <div class="col-md-6">
        <label class="form-label fw-semibold text-muted small text-uppercase">End Date</label>
        <div class="input-group modern-input-group">
          <span class="input-group-text bg-white"><i class="fi fi-rr-calendar-check text-success"></i></span>
          <input readonly class="form-control border-start-0" placeholder="dd-mm-yyyy" name="endRecur"
            [(ngModel)]="range.end" ngbDatepicker #a="ngbDatepicker" #endRecur="ngModel" required
            (ngModelChange)="selectDate($event, 'end')" [minDate]="minDate" (click)="a.toggle()" />
        </div>
        <div *ngIf="validTime['end']" class="text-danger small mt-1">{{ dateErrorMessages['end'] }}</div>
      </div>

      <div class="col-12">
        <div class="form-group mt-2">
          <label class="form-label fw-semibold text-muted small text-uppercase" translate>Repeat on</label>
          <ng-select name="daysOfWeek" [items]="dayOfWeek" [multiple]="true" bindLabel="name"
            class="custom-select-modern" [closeOnSelect]="false" placeholder="Select Days" bindValue="index"
            [(ngModel)]="recurring.dayOfWeek" #daysOfWeekRef="ngModel" required>
          </ng-select>
          <div *ngIf="daysOfWeekRef.invalid && (daysOfWeekRef.dirty || daysOfWeekRef.touched || isSubmitted)" class="text-danger small mt-1">
             Please select at least one day.
          </div>
        </div>
      </div>

      <div class="col-12 mt-4 pt-2 d-flex gap-2">
        <button type="submit" class="btn btn-primary px-4 py-2 flex-grow-1 shadow-sm rounded-pill fw-bold">
          Create Schedule
        </button>
        <button type="button" class="btn btn-light px-4 py-2 rounded-pill fw-bold border" (click)="close(null)">
          Cancel
        </button>
      </div>
    </div>
  </form>
</div>